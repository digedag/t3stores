# setup
includeLibs.tx_rnbase_controller = EXT:rn_base/class.tx_rnbase_controller.php



plugin.tx_t3stores                = USER
#plugin.tx_t3stores.flexform       = flexform_main.xml
plugin.tx_t3stores.userFunc       = tx_rnbase_controller->main
plugin.tx_t3stores.defaultAction  = \System25\T3stores\Action\StoreList
plugin.tx_t3stores.qualifier      = t3stores
plugin.tx_t3stores.templatePath   = EXT:t3stores/Resources/Private/Templates
plugin.tx_t3stores.locallangFilename = EXT:t3stores/Resources/Private/Language/locallang.xml


tt_content.list.20.tx_t3stores    =< plugin.tx_t3stores

lib.t3stores.price.stdWrap {
  numberFormat.decimals = 2
  wrap = |&nbsp;&euro;
}
lib.t3stores.promotion {
  discount.wrap = |%
  pickupdate.day.strftime = %d.%m.%Y
}
lib.t3stores.order {
  promotion =< lib.t3stores.promotion
  position =< lib.t3stores.orderposition
  positionpricestr < lib.t3stores.price
  discountvaluestr < lib.t3stores.price
  totalpricestr < lib.t3stores.price
}
lib.t3stores.orderposition {
	dcamount.field = amount
	dcamount.wrap =|&nbsp;kg
	offer =< lib.t3stores.offer
  pricestr < lib.t3stores.price
  pricestr.stdWrap.wrap = |&nbsp;&euro;/kg
  totalstr < lib.t3stores.price
}

lib.t3stores.store {
#  distance.number_format.decimal = 2
  distance.stdWrap.numberFormat.decimals = 2 
}
lib.t3stores.offer {
  pricestr.stdWrap.numberFormat.decimals = 2
  pricestr.stdWrap.wrap = |&nbsp;&euro;
}
lib.t3stores.offergroup {
  offer =< lib.t3stores.offer
}

lib.t3stores.product {
	dcthumbnail = IMG_RESOURCE
	dcthumbnail.file {
		import.cObject = USER
		import.cObject {
			# Mit dieser Methode wird nur die erste Referenz ausgewertet 
			userFunc=tx_rnbase_util_TSFAL->fetchFirstReference
			refField=images
			refTable=tx_t3stores_product
		}
		treatIdAsReference = 1
		maxW = 200
	}
	dcimage < .dcthumbnail
	dcimage.file.maxW = 1500
}

# Ab hier Konfiguration der einzelnen Views 
plugin.tx_t3stores {
  storelistTemplate = {$plugin.tx_t3stores.storelistTemplate}
  offergrouplistTemplate = {$plugin.tx_t3stores.offergrouplistTemplate}
  ordercreateTemplate = {$plugin.tx_t3stores.ordercreateTemplate}
  ordershowTemplate = {$plugin.tx_t3stores.ordershowTemplate}
  productlistTemplate = {$plugin.tx_t3stores.productlistTemplate}

  storelist {
    item =< lib.t3stores.store
    item.filter {
      class = System25\T3stores\Filter\Store
      template = EXT:t3stores/Resources/Private/Templates/stores.html
      subpart = ###SEARCH_FORM###
    }
  }

  offergrouplist {
    template.markerclass = System25\T3stores\Marker\OfferGroupMarker
    item.filter {
      class = tx_rnbase_filter_BaseFilter
    }
    item =< lib.t3stores.offergroup
  }
  ordercreate {
    promotion =< lib.t3stores.promotion
    order =< lib.t3stores.order
    sendMail2Customer = 1
    sendMail2Customer {
      template = {$plugin.tx_t3stores.orderemailTemplateCustomer}
      subpart = ###CUSTOMERMAIL###
      order =< lib.t3stores.order
      promotion =< lib.t3stores.promotion
      emailFrom = {$plugin.tx_t3stores.orderemailCustomerFrom}
      emailFromName = {$plugin.tx_t3stores.orderemailCustomerFromName}
      emailReply = {$plugin.tx_t3stores.orderemailCustomerReply}
    }
  }
  ordershow {
    promotion =< lib.t3stores.promotion
    order =< lib.t3stores.order
  }
  productlist {
  	item =< lib.t3stores.product
  }
}
